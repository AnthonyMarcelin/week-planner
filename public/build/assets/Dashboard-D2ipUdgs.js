import{j as e,u as U,r as g,a as D,H as W}from"./app-ysLP_Gev.js";import{A as G}from"./AuthenticatedLayout-Rz7F4Yhc.js";import{P as $}from"./PrimaryButton-ZAaYLaEl.js";import{S as F}from"./SecondaryButton-Dco5hVyn.js";import{t as M,H as R}from"./constants-CSCIf03m.js";import{M as z}from"./Modal-B1cmZYtP.js";import{T as S,I as _}from"./TextInput-DD7q0TL2.js";import{I as C}from"./InputLabel-TWkgDdpl.js";import{C as V}from"./Checkbox-YdaDSL6-.js";import"./ApplicationLogo-CvX7Jezd.js";import"./transition-BD7ttEEn.js";function J({activities:w,profiles:b,currentProfileId:d,weekOffset:N,isNightHidden:u,selectedDayMobile:r,onActivityClick:n,onDayMobileChange:i}){const f=u?4:0,j=Array.from({length:24-f},(s,m)=>m+f),t=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],c=(()=>{const s=new Date,m=s.getDay(),x=m===0?-6:1-m,h=new Date(s);h.setDate(s.getDate()+x);const l=new Date(h);l.setDate(h.getDate()+N*7);const v=new Date(l);v.setDate(l.getDate()+6);const y=a=>a.toLocaleDateString("fr-FR",{day:"numeric",month:"long"});return{start:y(l),end:y(v),mondayObject:l,todayString:new Date().toLocaleDateString("fr-FR")}})();return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"md:hidden flex overflow-x-auto pb-4 gap-2 px-4 scrollbar-hide",children:t.map((s,m)=>{const x=new Date(c.mondayObject);x.setDate(x.getDate()+m);const h=x.toLocaleDateString("fr-FR")===c.todayString;return e.jsxs("button",{onClick:()=>i(m),className:`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-all shadow-sm border flex flex-col items-center
                                ${r===m?"bg-indigo-600 text-white border-indigo-600":h?"bg-white text-indigo-600 border-indigo-200 ring-2 ring-indigo-100":"bg-white text-slate-500 border-slate-200"}`,children:[e.jsx("span",{children:s.slice(0,3)}),e.jsx("span",{className:"text-[10px] font-normal",children:x.getDate()})]},s)})}),e.jsx("div",{className:"md:hidden bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-bold text-yellow-800",children:[t[r]," - ",new Date(c.mondayObject).getDate()+r]}),e.jsx("button",{onClick:()=>i(s=>(s+1)%7),className:"text-yellow-600 hover:text-yellow-800 text-sm",children:"Jour suivant ‚Üí"})]})}),e.jsxs("div",{className:"flex bg-white shadow-xl shadow-slate-200/60 sm:rounded-2xl overflow-hidden border border-slate-200",children:[e.jsx("div",{className:"w-14 sm:w-20 bg-slate-50/50 border-r border-slate-200 pt-[48px] flex-shrink-0",children:j.map(s=>e.jsxs("div",{className:"h-[60px] text-[10px] sm:text-xs text-slate-400 text-center border-b border-slate-100 font-medium flex items-center justify-center",children:[s.toString().padStart(2,"0"),":00"]},s))}),e.jsx("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 lg:grid-cols-7 overflow-hidden",children:t.map((s,m)=>{const x=new Date(c.mondayObject);x.setDate(x.getDate()+m);const h=x.toLocaleDateString("fr-FR")===c.todayString;return e.jsxs("div",{className:`relative border-r border-slate-100 last:border-r-0 ${m===r?"block":"hidden"} md:block`,children:[e.jsxs("div",{className:`h-[48px] border-b border-slate-200 flex flex-col items-center justify-center font-bold text-[10px] uppercase tracking-widest transition-colors
                                    ${h?"bg-indigo-600 text-white shadow-inner":"bg-slate-50/30 text-slate-600"}`,children:[e.jsx("span",{children:s}),e.jsxs("span",{className:`text-[9px] ${h?"text-indigo-100":"text-slate-400"}`,children:[x.getDate()," ",x.toLocaleDateString("fr-FR",{month:"short"}).toUpperCase()]})]}),e.jsxs("div",{className:"relative",children:[j.map(l=>e.jsx("div",{className:"h-[60px] border-b border-slate-50"},l)),w&&w.filter(l=>Number(l.day_of_week)===m&&M(l.start_time)>=f&&Number(l.week_index)===N).map(l=>{const v=M(l.start_time),a=M(l.end_time)-v;return e.jsx("div",{onClick:()=>n(l),className:`absolute left-1 right-1 rounded-md p-2 text-[10px] leading-tight overflow-hidden shadow-sm border-l-4 z-10 cursor-pointer transition-all hover:brightness-95 hover:scale-[1.02] hover:shadow-md hover:z-50
                                                        ${l.type==="pro"?"bg-indigo-50 text-indigo-700 border-indigo-500":"bg-emerald-50 text-emerald-700 border-emerald-500"}`,style:{top:`${(v-f)*R}px`,height:`${a*R}px`,minHeight:"28px"},children:e.jsxs("div",{className:`flex ${a<=.5?"flex-row gap-2 items-baseline":"flex-col"}`,children:[e.jsx("div",{className:"font-bold truncate",children:l.label}),e.jsxs("div",{className:"opacity-80 font-medium whitespace-nowrap text-[9px]",children:[l.start_time.slice(0,5),a>.5&&` - ${l.end_time.slice(0,5)}`]})]})},l.id)})]})]},s)})})]})]})}function P({showModal:w,setShowModal:b,isEditing:d,setIsEditing:N,currentProfileId:u,activityToEdit:r}){const{data:n,setData:i,post:f,put:j,delete:t,processing:c,errors:s,reset:m,clearErrors:x}=U({id:null,label:"",start_time:"",end_time:"",type:"pro",days:[],day_of_week:null,group_id:null,scope:"single",profile_id:u});g.useEffect(()=>{i("profile_id",u)},[u,i]),g.useEffect(()=>{r&&d&&i({id:r.id,label:r.label,start_time:r.start_time.slice(0,5),end_time:r.end_time.slice(0,5),type:r.type,days:[],day_of_week:r.day_of_week,group_id:r.group_id,scope:"single",profile_id:u})},[r,d,u,i]);const h=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],l=a=>{a.preventDefault();const p={onSuccess:()=>{b(!1),m()}};d?D.patch(`/activities/${n.id}`,n,p):f("/activities",p)},v=a=>{const p=n.scope==="series"?"Voulez-vous vraiment supprimer TOUTE la s√©rie (4 semaines) ?":"Voulez-vous vraiment supprimer UNIQUEMENT cette activit√© ?";confirm(p)&&t(`/activities/${n.id}`,{data:{scope:n.scope},onSuccess:()=>{b(!1),m()}})},y=a=>{const p=n.days;i("days",p.includes(a)?p.filter(o=>o!==a):[...p,a])};return e.jsx(z,{show:w,onClose:()=>b(!1),children:e.jsxs("form",{onSubmit:l,className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 tracking-tight",children:d?"Modifier l'activit√©":"Nouvelle Activit√©"}),d&&e.jsx("button",{type:"button",onClick:()=>v(),className:"text-red-500 hover:text-red-700 text-xs font-bold uppercase tracking-tighter transition",children:"Supprimer"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(C,{htmlFor:"label",value:"Nom de l'activit√©"}),e.jsx(S,{id:"label",value:n.label,onChange:a=>i("label",a.target.value),className:"mt-1 block w-full",placeholder:"ex: R√©union Client, Sport..."}),e.jsx(_,{message:s.label,className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(C,{value:"‚è∞ D√©but"}),e.jsx(S,{type:"time",value:n.start_time,onChange:a=>i("start_time",a.target.value),className:"mt-1 block w-full"}),e.jsx(_,{message:s.start_time,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(C,{value:"üèÅ Fin"}),e.jsx(S,{type:"time",value:n.end_time,onChange:a=>i("end_time",a.target.value),className:"mt-1 block w-full"}),e.jsx(_,{message:s.end_time,className:"mt-1"})]})]}),d&&n.group_id&&e.jsxs("div",{className:"p-3 bg-indigo-50 rounded-lg border border-indigo-100",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx(V,{name:"scope",checked:n.scope==="series",onChange:a=>i("scope",a.target.checked?"series":"single")}),e.jsx("span",{className:"ms-2 text-sm text-indigo-900 font-medium",children:"Appliquer aux 4 semaines"})]}),e.jsx("p",{className:"text-[10px] text-indigo-600 mt-1 ml-6",children:"Si coch√©, la modification ou la suppression s'appliquera √† toute la s√©rie."})]}),!d&&e.jsxs("div",{children:[e.jsx(C,{value:"Jours de la semaine",className:"mb-2"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:h.map((a,p)=>e.jsx("button",{type:"button",onClick:()=>y(p),className:`px-3 py-1.5 rounded-lg border text-xs font-bold transition-all ${n.days.includes(p)?"bg-indigo-600 text-white border-indigo-600 shadow-md":"bg-slate-50 text-slate-500 border-slate-200 hover:border-slate-300"}`,children:a.slice(0,3)},a))}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1 italic",children:"Cr√©era automatiquement l'activit√© pour les 4 semaines √† venir."}),e.jsx(_,{message:s.days,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(C,{value:"Cat√©gorie",className:"mb-2"}),e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-xl",children:[e.jsx("button",{type:"button",onClick:()=>i("type","pro"),className:`flex-1 py-2 text-xs rounded-lg transition-all ${n.type==="pro"?"bg-white shadow-sm font-bold text-indigo-600":"text-slate-500 hover:text-slate-700"}`,children:"üíº Professionnel"}),e.jsx("button",{type:"button",onClick:()=>i("type","perso"),className:`flex-1 py-2 text-xs rounded-lg transition-all ${n.type==="perso"?"bg-white shadow-sm font-bold text-emerald-600":"text-slate-500 hover:text-slate-700"}`,children:"üè† Personnel"})]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[e.jsx(F,{onClick:()=>b(!1),children:"Annuler"}),e.jsx($,{disabled:c,children:d?"Mettre √† jour":"Planifier"})]})]})})}function q({showAgendasModal:w,setShowAgendasModal:b,profiles:d,onDeleteAgenda:N}){const[u,r]=g.useState(""),[n,i]=g.useState(!1),f=()=>{u.trim()&&(i(!0),D.post("/agendas",{name:u},{onSuccess:()=>{r(""),i(!1)},onError:()=>{i(!1)}}))},j=t=>{confirm("Supprimer cet agenda et toutes ses activit√©s ?")&&D.delete(`/agendas/${t}`,{preserveScroll:!0})};return e.jsx(z,{show:w,onClose:()=>b(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 tracking-tight mb-6",children:"G√©rer mes Agendas"}),e.jsx("div",{className:"space-y-4 mb-8",children:d.map(t=>e.jsxs("div",{className:"p-4 border border-slate-200 rounded-xl bg-slate-50 flex flex-col sm:flex-row gap-4 justify-between sm:items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("input",{type:"text",defaultValue:t.name,onBlur:c=>{c.target.value!==t.name&&D.put(`/agendas/${t.id}`,{name:c.target.value,is_public:t.is_public},{preserveScroll:!0})},className:"font-bold text-slate-800 bg-white border border-slate-200 rounded-lg px-3 py-1.5 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full",placeholder:"Nom de l'agenda"}),e.jsx("span",{className:"text-xs text-slate-400 font-medium whitespace-nowrap",children:t.is_public?"üåê Public":"üîí Priv√©"})]})}),e.jsx("div",{className:"flex items-center mt-2 gap-2",children:e.jsxs("label",{className:"flex items-center text-xs text-slate-600 cursor-pointer",children:[e.jsx(V,{checked:t.is_public===1||t.is_public===!0,onChange:c=>D.put(`/agendas/${t.id}`,{name:t.name,is_public:c.target.checked},{preserveScroll:!0})}),e.jsx("span",{className:"ml-2",children:"Lien public activ√©"})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(t.is_public===1||t.is_public===!0)&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`/view/${t.slug}`,target:"_blank",rel:"noreferrer",className:"text-xs bg-indigo-100 text-indigo-700 px-3 py-1.5 rounded-lg font-bold hover:bg-indigo-200 transition",children:"üëÄ Voir"}),e.jsx("button",{onClick:()=>{const c=`${window.location.origin}/view/${t.slug}`;navigator.clipboard&&window.isSecureContext?navigator.clipboard.writeText(c):prompt("Copiez manuellement ce lien :",c)},className:"text-xs bg-emerald-100 text-emerald-700 px-3 py-1.5 rounded-lg font-bold hover:bg-emerald-200 transition",children:"üîó Copier"})]}),e.jsx("button",{onClick:()=>j(t.id),className:"text-xs text-red-500 hover:text-red-700 font-bold p-2",disabled:d.length<=1,children:"üóëÔ∏è"})]})]},t.id))}),e.jsxs("div",{className:"border-t border-slate-200 pt-6",children:[e.jsx("h3",{className:"text-lg font-bold text-slate-800 mb-4",children:"Cr√©er un nouvel agenda"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(S,{value:u,onChange:t=>r(t.target.value),placeholder:"Ex: Cours Lyc√©e, Marie...",className:"flex-1"}),e.jsx($,{onClick:f,disabled:!u.trim()||n,children:n?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Cr√©ation..."]}):"Ajouter"})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(F,{onClick:()=>b(!1),children:"Fermer"})})]})})}function le({auth:w,activities:b,profiles:d=[],currentProfileId:N}){const[u,r]=g.useState(!1),[n,i]=g.useState(!0),[f,j]=g.useState(!1),[t,c]=g.useState(0),[s,m]=g.useState(0),[x,h]=g.useState(!1),[l,v]=g.useState(null),y=o=>{j(!0),v(o),r(!0)},a=()=>{r(!1),v(null),j(!1)},p=g.useMemo(()=>{const o=new Date,H=o.getDay(),T=H===0?-6:1-H,A=new Date(o);A.setDate(o.getDate()+T);const k=new Date(A);k.setDate(A.getDate()+s*7);const L=new Date(k);L.setDate(k.getDate()+6);const O=B=>B.toLocaleDateString("fr-FR",{day:"numeric",month:"long"});return{start:O(k),end:O(L),mondayObject:k,todayString:new Date().toLocaleDateString("fr-FR")}},[s]);return d.length===0?null:e.jsxs(G,{user:w.user,header:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("select",{value:N||"",onChange:o=>{D.get("/dashboard",{profile_id:o.target.value},{preserveState:!0})},className:"text-xl font-bold text-slate-800 tracking-tight bg-transparent border-none focus:ring-0 cursor-pointer hover:bg-slate-100 rounded-lg py-1 pl-2 pr-8",children:d.map(o=>e.jsx("option",{value:o.id,children:o.name},o.id))}),e.jsxs("span",{className:"text-xs text-slate-400 font-medium",children:["(",d.find(o=>o.id===N)?.is_public?"üåê Public":"üîí Priv√©",")"]})]}),e.jsx("button",{onClick:()=>h(!0),className:"p-2 bg-white border border-slate-200 text-slate-500 rounded-lg hover:bg-slate-50 transition shadow-sm text-sm",title:"G√©rer les agendas",children:"üë•"})]}),e.jsxs("div",{className:"flex items-center bg-white rounded-xl shadow-sm border border-slate-200 p-1",children:[e.jsx("button",{onClick:()=>m(o=>Math.max(0,o-1)),disabled:s===0,className:"p-2 hover:bg-slate-50 disabled:opacity-30 rounded-lg transition text-slate-600",children:"‚¨ÖÔ∏è"}),e.jsxs("span",{className:"px-2 sm:px-4 text-xs sm:text-sm font-bold text-slate-700 w-[180px] sm:w-[220px] text-center truncate",children:[p.start," - ",p.end]}),e.jsx("button",{onClick:()=>m(o=>Math.min(3,o+1)),disabled:s===3,className:"p-2 hover:bg-slate-50 disabled:opacity-30 rounded-lg transition text-slate-600",children:"‚û°Ô∏è"})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-end",children:[e.jsx(F,{onClick:()=>i(!n),className:"text-xs",children:n?"üëÅÔ∏è 00h+":"üåô Cacher"}),e.jsx($,{onClick:()=>{j(!1),r(!0)},className:"text-xs whitespace-nowrap",children:"+ Activit√©"})]})]})}),children:[e.jsx(W,{title:"Planning"}),e.jsx("div",{className:"py-6 sm:py-12 bg-slate-50/50 min-h-screen",children:e.jsx("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:e.jsx(J,{activities:b,profiles:d,currentProfileId:N,weekOffset:s,isNightHidden:n,selectedDayMobile:t,onDayMobileChange:c,onActivityClick:y})})}),e.jsx(q,{showAgendasModal:x,setShowAgendasModal:h,profiles:d}),e.jsx(P,{showModal:u,setShowModal:a,isEditing:f,setIsEditing:j,currentProfileId:N,activityToEdit:l})]})}export{le as default};
