import{r as o,u as se,j as e,H as ae,a as g}from"./app-CrrSkPms.js";import{A as le}from"./AuthenticatedLayout-0cRD4RfK.js";import{M as U}from"./Modal-BeZHhp4Z.js";import{P as $}from"./PrimaryButton-eWnUbHVx.js";import{S as A}from"./SecondaryButton--CVxJh8P.js";import{T as _,I as k}from"./TextInput-CPbcH-mB.js";import{I as b}from"./InputLabel-CG2nU_ho.js";import{C as V}from"./Checkbox-DIaNoljF.js";import"./ApplicationLogo-ChQDx5OS.js";import"./transition-sglZBtPv.js";const E=f=>{if(!f)return 0;const[j,x]=f.split(":").map(Number);return j+x/60},q=60;function he({auth:f,activities:j,profiles:x=[],currentProfileId:v}){const[B,d]=o.useState(!1),[C,G]=o.useState(!0),[c,T]=o.useState(!1),[F,P]=o.useState(0),[p,H]=o.useState(0),[I,D]=o.useState(!1),[N,L]=o.useState(""),w=C?4:0,O=Array.from({length:24-w},(t,s)=>s+w),{data:r,setData:i,post:J,put:W,delete:Q,processing:K,errors:y,reset:R,clearErrors:z}=se({id:null,label:"",start_time:"",end_time:"",type:"pro",days:[],day_of_week:null,group_id:null,scope:"single",profile_id:v}),S=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],m=o.useMemo(()=>{const t=new Date,s=t.getDay(),l=s===0?-6:1-s,n=new Date(t);n.setDate(t.getDate()+l);const a=new Date(n);a.setDate(n.getDate()+p*7);const u=new Date(a);u.setDate(a.getDate()+6);const M=h=>h.toLocaleDateString("fr-FR",{day:"numeric",month:"long"});return{start:M(a),end:M(u),mondayObject:a,todayString:new Date().toLocaleDateString("fr-FR")}},[p]),X=()=>{T(!1),i({id:null,label:"",start_time:"",end_time:"",type:"pro",days:[],day_of_week:null,group_id:null,scope:"series",profile_id:v}),z(),d(!0)},Y=t=>{T(!0),i({id:t.id,label:t.label,start_time:t.start_time.slice(0,5),end_time:t.end_time.slice(0,5),type:t.type,days:[],day_of_week:t.day_of_week,group_id:t.group_id,scope:"single",profile_id:v}),z(),d(!0)},Z=t=>{t.preventDefault();const s={onSuccess:()=>{d(!1),R()}};c?W(`/activities/${r.id}`,s):J("/activities",s)},ee=()=>{const t=r.scope==="series"?"Voulez-vous vraiment supprimer TOUTE la s√©rie (4 semaines) ?":"Voulez-vous vraiment supprimer UNIQUEMENT cette activit√© ?";confirm(t)&&Q(`/activities/${r.id}`,{data:{scope:r.scope},onSuccess:()=>{d(!1),R()}})},te=t=>{const s=r.days;i("days",s.includes(t)?s.filter(l=>l!==t):[...s,t])};return e.jsxs(le,{user:f.user,header:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("select",{value:v||"",onChange:t=>{g.get("/dashboard",{profile_id:t.target.value},{preserveState:!0})},className:"text-xl font-bold text-slate-800 tracking-tight bg-transparent border-none focus:ring-0 cursor-pointer hover:bg-slate-100 rounded-lg py-1 pl-2 pr-8",children:x.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))}),e.jsx("button",{onClick:()=>D(!0),className:"p-2 bg-white border border-slate-200 text-slate-500 rounded-lg hover:bg-slate-50 transition shadow-sm text-sm",title:"G√©rer les agendas",children:"üë•"})]}),e.jsxs("div",{className:"flex items-center bg-white rounded-xl shadow-sm border border-slate-200 p-1",children:[e.jsx("button",{onClick:()=>H(t=>Math.max(0,t-1)),disabled:p===0,className:"p-2 hover:bg-slate-50 disabled:opacity-30 rounded-lg transition text-slate-600",children:"‚¨ÖÔ∏è"}),e.jsxs("span",{className:"px-2 sm:px-4 text-xs sm:text-sm font-bold text-slate-700 w-[180px] sm:w-[220px] text-center truncate",children:[m.start," - ",m.end]}),e.jsx("button",{onClick:()=>H(t=>Math.min(3,t+1)),disabled:p===3,className:"p-2 hover:bg-slate-50 disabled:opacity-30 rounded-lg transition text-slate-600",children:"‚û°Ô∏è"})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-end",children:[e.jsx(A,{onClick:()=>G(!C),className:"text-xs",children:C?"üëÅÔ∏è 00h+":"üåô Cacher"}),e.jsx($,{onClick:X,className:"text-xs whitespace-nowrap",children:"+ Activit√©"})]})]})}),children:[e.jsx(ae,{title:"Planning"}),e.jsx("div",{className:"py-6 sm:py-12 bg-slate-50/50 min-h-screen",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx("div",{className:"md:hidden flex overflow-x-auto pb-4 gap-2 px-4 scrollbar-hide",children:S.map((t,s)=>{const l=new Date(m.mondayObject);l.setDate(l.getDate()+s);const n=l.toLocaleDateString("fr-FR")===m.todayString;return e.jsxs("button",{onClick:()=>P(s),className:`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-all shadow-sm border flex flex-col items-center
                                        ${F===s?"bg-indigo-600 text-white border-indigo-600":n?"bg-white text-indigo-600 border-indigo-200 ring-2 ring-indigo-100":"bg-white text-slate-500 border-slate-200"}`,children:[e.jsx("span",{children:t.slice(0,3)}),e.jsx("span",{className:"text-[10px] font-normal",children:l.getDate()})]},t)})}),e.jsxs("div",{className:"flex bg-white shadow-xl shadow-slate-200/60 sm:rounded-2xl overflow-hidden border border-slate-200",children:[e.jsx("div",{className:"w-14 sm:w-20 bg-slate-50/50 border-r border-slate-200 pt-[48px] flex-shrink-0",children:O.map(t=>e.jsxs("div",{className:"h-[60px] text-[10px] sm:text-xs text-slate-400 text-center border-b border-slate-100 font-medium flex items-center justify-center",children:[t.toString().padStart(2,"0"),":00"]},t))}),e.jsx("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-7 overflow-hidden md:min-w-[840px] md:overflow-x-auto",children:S.map((t,s)=>{const l=new Date(m.mondayObject);l.setDate(l.getDate()+s);const n=l.toLocaleDateString("fr-FR")===m.todayString;return e.jsxs("div",{className:`relative border-r border-slate-100 last:border-r-0 ${F===s?"block":"hidden md:block"}`,children:[e.jsxs("div",{className:`h-[48px] border-b border-slate-200 flex flex-col items-center justify-center font-bold text-[10px] uppercase tracking-widest transition-colors
                                            ${n?"bg-indigo-600 text-white shadow-inner":"bg-slate-50/30 text-slate-600"}`,children:[e.jsx("span",{children:t}),e.jsxs("span",{className:`text-[9px] ${n?"text-indigo-100":"text-slate-400"}`,children:[l.getDate()," ",l.toLocaleDateString("fr-FR",{month:"short"}).toUpperCase()]})]}),e.jsxs("div",{className:"relative",children:[O.map(a=>e.jsx("div",{className:"h-[60px] border-b border-slate-50"},a)),j&&j.filter(a=>Number(a.day_of_week)===s&&E(a.start_time)>=w&&Number(a.week_index)===p).map(a=>{const u=E(a.start_time),h=E(a.end_time)-u;return e.jsx("div",{onClick:()=>Y(a),className:`absolute left-1 right-1 rounded-md p-2 text-[10px] leading-tight overflow-hidden shadow-sm border-l-4 z-10 cursor-pointer transition-all hover:brightness-95 hover:scale-[1.02] hover:shadow-md hover:z-50
                                                                ${a.type==="pro"?"bg-indigo-50 text-indigo-700 border-indigo-500":"bg-emerald-50 text-emerald-700 border-emerald-500"}`,style:{top:`${(u-w)*q}px`,height:`${h*q}px`,minHeight:"28px"},children:e.jsxs("div",{className:`flex ${h<=.5?"flex-row gap-2 items-baseline":"flex-col"}`,children:[e.jsx("div",{className:"font-bold truncate",children:a.label}),e.jsxs("div",{className:"opacity-80 font-medium whitespace-nowrap text-[9px]",children:[a.start_time.slice(0,5),h>.5&&` - ${a.end_time.slice(0,5)}`]})]})},a.id)})]})]},t)})})]})]})}),e.jsx(U,{show:B,onClose:()=>d(!1),children:e.jsxs("form",{onSubmit:Z,className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 tracking-tight",children:c?"Modifier l'activit√©":"Nouvelle Activit√©"}),c&&e.jsx("button",{type:"button",onClick:ee,className:"text-red-500 hover:text-red-700 text-xs font-bold uppercase tracking-tighter transition",children:"Supprimer"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{htmlFor:"label",value:"Nom de l'activit√©"}),e.jsx(_,{id:"label",value:r.label,onChange:t=>i("label",t.target.value),className:"mt-1 block w-full",placeholder:"ex: R√©union Client, Sport..."}),e.jsx(k,{message:y.label,className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(b,{value:"‚è∞ D√©but"}),e.jsx(_,{type:"time",value:r.start_time,onChange:t=>i("start_time",t.target.value),className:"mt-1 block w-full"}),e.jsx(k,{message:y.start_time,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(b,{value:"üèÅ Fin"}),e.jsx(_,{type:"time",value:r.end_time,onChange:t=>i("end_time",t.target.value),className:"mt-1 block w-full"}),e.jsx(k,{message:y.end_time,className:"mt-1"})]})]}),c&&r.group_id&&e.jsxs("div",{className:"p-3 bg-indigo-50 rounded-lg border border-indigo-100",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx(V,{name:"scope",checked:r.scope==="series",onChange:t=>i("scope",t.target.checked?"series":"single")}),e.jsx("span",{className:"ms-2 text-sm text-indigo-900 font-medium",children:"Appliquer aux 4 semaines"})]}),e.jsx("p",{className:"text-[10px] text-indigo-600 mt-1 ml-6",children:"Si coch√©, la modification ou la suppression s'appliquera √† toute la s√©rie."})]}),!c&&e.jsxs("div",{children:[e.jsx(b,{value:"Jours de la semaine",className:"mb-2"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:S.map((t,s)=>e.jsx("button",{type:"button",onClick:()=>te(s),className:`px-3 py-1.5 rounded-lg border text-xs font-bold transition-all ${r.days.includes(s)?"bg-indigo-600 text-white border-indigo-600 shadow-md":"bg-slate-50 text-slate-500 border-slate-200 hover:border-slate-300"}`,children:t.slice(0,3)},t))}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1 italic",children:"Cr√©era automatiquement l'activit√© pour les 4 semaines √† venir."}),e.jsx(k,{message:y.days,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(b,{value:"Cat√©gorie",className:"mb-2"}),e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-xl",children:[e.jsx("button",{type:"button",onClick:()=>i("type","pro"),className:`flex-1 py-2 text-xs rounded-lg transition-all ${r.type==="pro"?"bg-white shadow-sm font-bold text-indigo-600":"text-slate-500 hover:text-slate-700"}`,children:"üíº Professionnel"}),e.jsx("button",{type:"button",onClick:()=>i("type","perso"),className:`flex-1 py-2 text-xs rounded-lg transition-all ${r.type==="perso"?"bg-white shadow-sm font-bold text-emerald-600":"text-slate-500 hover:text-slate-700"}`,children:"üè† Personnel"})]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[e.jsx(A,{onClick:()=>d(!1),children:"Annuler"}),e.jsx($,{disabled:K,children:c?"Mettre √† jour":"Planifier"})]})]})}),e.jsx(U,{show:I,onClose:()=>D(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 tracking-tight mb-6",children:"G√©rer mes Agendas"}),e.jsx("div",{className:"space-y-4 mb-8",children:x.map(t=>e.jsxs("div",{className:"p-4 border border-slate-200 rounded-xl bg-slate-50 flex flex-col sm:flex-row gap-4 justify-between sm:items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("input",{type:"text",defaultValue:t.name,onBlur:s=>{s.target.value!==t.name&&g.put(`/agendas/${t.id}`,{name:s.target.value,is_public:t.is_public},{preserveScroll:!0})},className:"font-bold text-slate-800 bg-transparent border-none p-0 focus:ring-0 w-full"}),e.jsx("div",{className:"flex items-center mt-2 gap-2",children:e.jsxs("label",{className:"flex items-center text-xs text-slate-600 cursor-pointer",children:[e.jsx(V,{checked:t.is_public===1||t.is_public===!0,onChange:s=>g.put(`/agendas/${t.id}`,{name:t.name,is_public:s.target.checked},{preserveScroll:!0})}),e.jsx("span",{className:"ml-2",children:"Lien public activ√©"})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(t.is_public===1||t.is_public===!0)&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`/view/${t.slug}`,target:"_blank",rel:"noreferrer",className:"text-xs bg-indigo-100 text-indigo-700 px-3 py-1.5 rounded-lg font-bold hover:bg-indigo-200 transition",children:"üëÄ Voir"}),e.jsx("button",{onClick:()=>{const s=`${window.location.origin}/view/${t.slug}`;navigator.clipboard&&window.isSecureContext?(navigator.clipboard.writeText(s),alert("Lien public copi√© !")):prompt("Copiez manuellement ce lien :",s)},className:"text-xs bg-emerald-100 text-emerald-700 px-3 py-1.5 rounded-lg font-bold hover:bg-emerald-200 transition",children:"üîó Copier"})]}),e.jsx("button",{onClick:()=>{confirm("Supprimer cet agenda et toutes ses activit√©s ?")&&g.delete(`/agendas/${t.id}`,{preserveScroll:!0})},className:"text-xs text-red-500 hover:text-red-700 font-bold p-2",disabled:x.length<=1,children:"üóëÔ∏è"})]})]},t.id))}),e.jsxs("div",{className:"border-t border-slate-200 pt-6",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-800 mb-3",children:"Nouvel agenda"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(_,{value:N,onChange:t=>L(t.target.value),placeholder:"Ex: Cours Lyc√©e, Marie...",className:"flex-1"}),e.jsx($,{onClick:()=>{N.trim()&&g.post("/agendas",{name:N},{onSuccess:()=>L("")})},disabled:!N.trim(),children:"Ajouter"})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(A,{onClick:()=>D(!1),children:"Fermer"})})]})})]})}export{he as default};
