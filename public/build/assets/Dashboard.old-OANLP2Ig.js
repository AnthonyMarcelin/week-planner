import{r,u as ue,j as e,H as ge,a as f}from"./app-ysLP_Gev.js";import{A as be}from"./AuthenticatedLayout-Rz7F4Yhc.js";import{M as H}from"./Modal-B1cmZYtP.js";import{P as j}from"./PrimaryButton-ZAaYLaEl.js";import{S as N}from"./SecondaryButton-Dco5hVyn.js";import{T as z,I as T}from"./TextInput-DD7q0TL2.js";import{I as v}from"./InputLabel-TWkgDdpl.js";import{C as Y}from"./Checkbox-YdaDSL6-.js";import"./ApplicationLogo-CvX7Jezd.js";import"./transition-BD7ttEEn.js";const V=w=>{if(!w)return 0;const[y,c]=w.split(":").map(Number);return y+c/60},Z=60;function Se({auth:w,activities:y,profiles:c=[],currentProfileId:h}){const[ee,m]=r.useState(!1),[F,se]=r.useState(!0),[x,P]=r.useState(!1),[C,B]=r.useState(0),[u,U]=r.useState(0),[te,L]=r.useState(!1),[k,W]=r.useState(""),[q,O]=r.useState(!1),[ae,_]=r.useState(!1),[le,D]=r.useState(!1),[G,I]=r.useState(""),[S,J]=r.useState(null),[M,p]=r.useState(!1),A=F?4:0,Q=Array.from({length:24-A},(s,t)=>t+A),{data:n,setData:i,post:re,put:ne,delete:ie,processing:oe,errors:$,reset:K,clearErrors:X}=ue({id:null,label:"",start_time:"",end_time:"",type:"pro",days:[],day_of_week:null,group_id:null,scope:"single",profile_id:h}),E=["Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi","Dimanche"],d=r.useMemo(()=>{const s=new Date,t=s.getDay(),l=t===0?-6:1-t,o=new Date(s);o.setDate(s.getDate()+l);const a=new Date(o);a.setDate(o.getDate()+u*7);const g=new Date(a);g.setDate(a.getDate()+6);const R=b=>b.toLocaleDateString("fr-FR",{day:"numeric",month:"long"});return{start:R(a),end:R(g),mondayObject:a,todayString:new Date().toLocaleDateString("fr-FR")}},[u]),de=()=>{P(!1),i({id:null,label:"",start_time:"",end_time:"",type:"pro",days:[],day_of_week:null,group_id:null,scope:"series",profile_id:h}),X(),m(!0)},ce=s=>{P(!0),i({id:s.id,label:s.label,start_time:s.start_time.slice(0,5),end_time:s.end_time.slice(0,5),type:s.type,days:[],day_of_week:s.day_of_week,group_id:s.group_id,scope:"single",profile_id:h}),X(),m(!0)},me=s=>{s.preventDefault();const t={onSuccess:()=>{m(!1),K()}};x?ne(`/activities/${n.id}`,t):re("/activities",t)},xe=()=>{const s=n.scope==="series"?"Voulez-vous vraiment supprimer TOUTE la sÃ©rie (4 semaines) ?":"Voulez-vous vraiment supprimer UNIQUEMENT cette activitÃ© ?";I(s),J(()=>()=>{p(!0),ie(`/activities/${n.id}`,{data:{scope:n.scope},onSuccess:()=>{m(!1),_(!1),K(),p(!1)},onError:()=>{p(!1)}})}),_(!0)},pe=s=>{I("Supprimer cet agenda et toutes ses activitÃ©s ?"),J(()=>()=>{p(!0),f.delete(`/agendas/${s}`,{preserveScroll:!0,onSuccess:()=>{D(!1),p(!1)},onError:()=>{p(!1)}})}),D(!0)},he=s=>{const t=n.days;i("days",t.includes(s)?t.filter(l=>l!==s):[...t,s])};return e.jsxs(be,{user:w.user,header:e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("select",{value:h||"",onChange:s=>{f.get("/dashboard",{profile_id:s.target.value},{preserveState:!0})},className:"text-xl font-bold text-slate-800 tracking-tight bg-transparent border-none focus:ring-0 cursor-pointer hover:bg-slate-100 rounded-lg py-1 pl-2 pr-8",children:c.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))}),e.jsxs("span",{className:"text-xs text-slate-400 font-medium",children:["(",c.find(s=>s.id===h)?.is_public?"ðŸŒ Public":"ðŸ”’ PrivÃ©",")"]})]}),e.jsx("button",{onClick:()=>L(!0),className:"p-2 bg-white border border-slate-200 text-slate-500 rounded-lg hover:bg-slate-50 transition shadow-sm text-sm",title:"GÃ©rer les agendas",children:"ðŸ‘¥"})]}),e.jsxs("div",{className:"flex items-center bg-white rounded-xl shadow-sm border border-slate-200 p-1",children:[e.jsx("button",{onClick:()=>U(s=>Math.max(0,s-1)),disabled:u===0,className:"p-2 hover:bg-slate-50 disabled:opacity-30 rounded-lg transition text-slate-600",children:"â¬…ï¸"}),e.jsxs("span",{className:"px-2 sm:px-4 text-xs sm:text-sm font-bold text-slate-700 w-[180px] sm:w-[220px] text-center truncate",children:[d.start," - ",d.end]}),e.jsx("button",{onClick:()=>U(s=>Math.min(3,s+1)),disabled:u===3,className:"p-2 hover:bg-slate-50 disabled:opacity-30 rounded-lg transition text-slate-600",children:"âž¡ï¸"})]}),e.jsxs("div",{className:"flex gap-2 w-full sm:w-auto justify-end",children:[e.jsx(N,{onClick:()=>se(!F),className:"text-xs",children:F?"ðŸ‘ï¸ 00h+":"ðŸŒ™ Cacher"}),e.jsx(j,{onClick:de,className:"text-xs whitespace-nowrap",children:"+ ActivitÃ©"})]})]})}),children:[e.jsx(ge,{title:"Planning"}),e.jsx("div",{className:"py-6 sm:py-12 bg-slate-50/50 min-h-screen",children:e.jsxs("div",{className:"mx-auto max-w-7xl sm:px-6 lg:px-8",children:[e.jsx("div",{className:"md:hidden flex overflow-x-auto pb-4 gap-2 px-4 scrollbar-hide",children:E.map((s,t)=>{const l=new Date(d.mondayObject);l.setDate(l.getDate()+t);const o=l.toLocaleDateString("fr-FR")===d.todayString;return e.jsxs("button",{onClick:()=>B(t),className:`px-4 py-2 rounded-full text-sm font-bold whitespace-nowrap transition-all shadow-sm border flex flex-col items-center
                                        ${C===t?"bg-indigo-600 text-white border-indigo-600":o?"bg-white text-indigo-600 border-indigo-200 ring-2 ring-indigo-100":"bg-white text-slate-500 border-slate-200"}`,children:[e.jsx("span",{children:s.slice(0,3)}),e.jsx("span",{className:"text-[10px] font-normal",children:l.getDate()})]},s)})}),e.jsx("div",{className:"md:hidden bg-yellow-50 border border-yellow-200 rounded-lg p-3 mb-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"font-bold text-yellow-800",children:[E[C]," - ",new Date(d.mondayObject).getDate()+C]}),e.jsx("button",{onClick:()=>B(s=>(s+1)%7),className:"text-yellow-600 hover:text-yellow-800 text-sm",children:"Jour suivant â†’"})]})}),e.jsxs("div",{className:"flex bg-white shadow-xl shadow-slate-200/60 sm:rounded-2xl overflow-hidden border border-slate-200",children:[e.jsx("div",{className:"w-14 sm:w-20 bg-slate-50/50 border-r border-slate-200 pt-[48px] flex-shrink-0",children:Q.map(s=>e.jsxs("div",{className:"h-[60px] text-[10px] sm:text-xs text-slate-400 text-center border-b border-slate-100 font-medium flex items-center justify-center",children:[s.toString().padStart(2,"0"),":00"]},s))}),e.jsx("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-3 lg:grid-cols-7 overflow-hidden",children:E.map((s,t)=>{const l=new Date(d.mondayObject);l.setDate(l.getDate()+t);const o=l.toLocaleDateString("fr-FR")===d.todayString;return e.jsxs("div",{className:`relative border-r border-slate-100 last:border-r-0 ${t===C?"block":"hidden"} md:block`,children:[e.jsxs("div",{className:`h-[48px] border-b border-slate-200 flex flex-col items-center justify-center font-bold text-[10px] uppercase tracking-widest transition-colors
                                            ${o?"bg-indigo-600 text-white shadow-inner":"bg-slate-50/30 text-slate-600"}`,children:[e.jsx("span",{children:s}),e.jsxs("span",{className:`text-[9px] ${o?"text-indigo-100":"text-slate-400"}`,children:[l.getDate()," ",l.toLocaleDateString("fr-FR",{month:"short"}).toUpperCase()]})]}),e.jsxs("div",{className:"relative",children:[Q.map(a=>e.jsx("div",{className:"h-[60px] border-b border-slate-50"},a)),y&&y.filter(a=>Number(a.day_of_week)===t&&V(a.start_time)>=A&&Number(a.week_index)===u).map(a=>{const g=V(a.start_time),b=V(a.end_time)-g;return e.jsx("div",{onClick:()=>ce(a),className:`absolute left-1 right-1 rounded-md p-2 text-[10px] leading-tight overflow-hidden shadow-sm border-l-4 z-10 cursor-pointer transition-all hover:brightness-95 hover:scale-[1.02] hover:shadow-md hover:z-50
                                                                ${a.type==="pro"?"bg-indigo-50 text-indigo-700 border-indigo-500":"bg-emerald-50 text-emerald-700 border-emerald-500"}`,style:{top:`${(g-A)*Z}px`,height:`${b*Z}px`,minHeight:"28px"},children:e.jsxs("div",{className:`flex ${b<=.5?"flex-row gap-2 items-baseline":"flex-col"}`,children:[e.jsx("div",{className:"font-bold truncate",children:a.label}),e.jsxs("div",{className:"opacity-80 font-medium whitespace-nowrap text-[9px]",children:[a.start_time.slice(0,5),b>.5&&` - ${a.end_time.slice(0,5)}`]})]})},a.id)})]})]},s)})})]})]})}),e.jsx(H,{show:ee,onClose:()=>m(!1),children:e.jsxs("form",{onSubmit:me,className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 tracking-tight",children:x?"Modifier l'activitÃ©":"Nouvelle ActivitÃ©"}),x&&e.jsx("button",{type:"button",onClick:xe,className:"text-red-500 hover:text-red-700 text-xs font-bold uppercase tracking-tighter transition",children:"Supprimer"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(v,{htmlFor:"label",value:"Nom de l'activitÃ©"}),e.jsx(z,{id:"label",value:n.label,onChange:s=>i("label",s.target.value),className:"mt-1 block w-full",placeholder:"ex: RÃ©union Client, Sport..."}),e.jsx(T,{message:$.label,className:"mt-1"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(v,{value:"â° DÃ©but"}),e.jsx(z,{type:"time",value:n.start_time,onChange:s=>i("start_time",s.target.value),className:"mt-1 block w-full"}),e.jsx(T,{message:$.start_time,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(v,{value:"ðŸ Fin"}),e.jsx(z,{type:"time",value:n.end_time,onChange:s=>i("end_time",s.target.value),className:"mt-1 block w-full"}),e.jsx(T,{message:$.end_time,className:"mt-1"})]})]}),x&&n.group_id&&e.jsxs("div",{className:"p-3 bg-indigo-50 rounded-lg border border-indigo-100",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx(Y,{name:"scope",checked:n.scope==="series",onChange:s=>i("scope",s.target.checked?"series":"single")}),e.jsx("span",{className:"ms-2 text-sm text-indigo-900 font-medium",children:"Appliquer aux 4 semaines"})]}),e.jsx("p",{className:"text-[10px] text-indigo-600 mt-1 ml-6",children:"Si cochÃ©, la modification ou la suppression s'appliquera Ã  toute la sÃ©rie."})]}),!x&&e.jsxs("div",{children:[e.jsx(v,{value:"Jours de la semaine",className:"mb-2"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:E.map((s,t)=>e.jsx("button",{type:"button",onClick:()=>he(t),className:`px-3 py-1.5 rounded-lg border text-xs font-bold transition-all ${n.days.includes(t)?"bg-indigo-600 text-white border-indigo-600 shadow-md":"bg-slate-50 text-slate-500 border-slate-200 hover:border-slate-300"}`,children:s.slice(0,3)},s))}),e.jsx("p",{className:"text-[10px] text-slate-400 mt-1 italic",children:"CrÃ©era automatiquement l'activitÃ© pour les 4 semaines Ã  venir."}),e.jsx(T,{message:$.days,className:"mt-1"})]}),e.jsxs("div",{children:[e.jsx(v,{value:"CatÃ©gorie",className:"mb-2"}),e.jsxs("div",{className:"flex bg-slate-100 p-1 rounded-xl",children:[e.jsx("button",{type:"button",onClick:()=>i("type","pro"),className:`flex-1 py-2 text-xs rounded-lg transition-all ${n.type==="pro"?"bg-white shadow-sm font-bold text-indigo-600":"text-slate-500 hover:text-slate-700"}`,children:"ðŸ’¼ Professionnel"}),e.jsx("button",{type:"button",onClick:()=>i("type","perso"),className:`flex-1 py-2 text-xs rounded-lg transition-all ${n.type==="perso"?"bg-white shadow-sm font-bold text-emerald-600":"text-slate-500 hover:text-slate-700"}`,children:"ðŸ  Personnel"})]})]})]}),e.jsxs("div",{className:"mt-8 flex justify-end gap-3",children:[e.jsx(N,{onClick:()=>m(!1),children:"Annuler"}),e.jsx(j,{disabled:oe,children:x?"Mettre Ã  jour":"Planifier"})]})]})}),e.jsx(H,{show:te,onClose:()=>L(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsx("h2",{className:"text-xl font-black text-slate-800 tracking-tight mb-6",children:"GÃ©rer mes Agendas"}),e.jsx("div",{className:"space-y-4 mb-8",children:c.map(s=>e.jsxs("div",{className:"p-4 border border-slate-200 rounded-xl bg-slate-50 flex flex-col sm:flex-row gap-4 justify-between sm:items-center",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("div",{className:"flex-1 flex items-center gap-2",children:[e.jsx("input",{type:"text",defaultValue:s.name,onBlur:t=>{t.target.value!==s.name&&f.put(`/agendas/${s.id}`,{name:t.target.value,is_public:s.is_public},{preserveScroll:!0})},className:"font-bold text-slate-800 bg-white border border-slate-200 rounded-lg px-3 py-1.5 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 w-full",placeholder:"Nom de l'agenda"}),e.jsx("span",{className:"text-xs text-slate-400 font-medium whitespace-nowrap",children:s.is_public?"ðŸŒ Public":"ðŸ”’ PrivÃ©"})]})}),e.jsx("div",{className:"flex items-center mt-2 gap-2",children:e.jsxs("label",{className:"flex items-center text-xs text-slate-600 cursor-pointer",children:[e.jsx(Y,{checked:s.is_public===1||s.is_public===!0,onChange:t=>f.put(`/agendas/${s.id}`,{name:s.name,is_public:t.target.checked},{preserveScroll:!0})}),e.jsx("span",{className:"ml-2",children:"Lien public activÃ©"})]})})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[(s.is_public===1||s.is_public===!0)&&e.jsxs(e.Fragment,{children:[e.jsx("a",{href:`/view/${s.slug}`,target:"_blank",rel:"noreferrer",className:"text-xs bg-indigo-100 text-indigo-700 px-3 py-1.5 rounded-lg font-bold hover:bg-indigo-200 transition",children:"ðŸ‘€ Voir"}),e.jsx("button",{onClick:()=>{const t=`${window.location.origin}/view/${s.slug}`;navigator.clipboard&&window.isSecureContext?(navigator.clipboard.writeText(t),alert("Lien public copiÃ© !")):prompt("Copiez manuellement ce lien :",t)},className:"text-xs bg-emerald-100 text-emerald-700 px-3 py-1.5 rounded-lg font-bold hover:bg-emerald-200 transition",children:"ðŸ”— Copier"})]}),e.jsx("button",{onClick:()=>pe(s.id),className:"text-xs text-red-500 hover:text-red-700 font-bold p-2",disabled:c.length<=1,children:"ðŸ—‘ï¸"})]})]},s.id))}),e.jsxs("div",{className:"border-t border-slate-200 pt-6",children:[e.jsx("h3",{className:"text-sm font-bold text-slate-800 mb-3",children:"Nouvel agenda"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(z,{value:k,onChange:s=>W(s.target.value),placeholder:"Ex: Cours LycÃ©e, Marie...",className:"flex-1"}),e.jsx(j,{onClick:()=>{k.trim()&&(O(!0),f.post("/agendas",{name:k},{onSuccess:()=>{W(""),O(!1)},onError:()=>{O(!1)}}))},disabled:!k.trim()||q,children:q?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"CrÃ©ation..."]}):"Ajouter"})]})]}),e.jsx("div",{className:"mt-6 flex justify-end",children:e.jsx(N,{onClick:()=>L(!1),children:"Fermer"})})]})}),e.jsx(H,{show:ae,onClose:()=>_(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4",children:e.jsx("span",{className:"text-red-600 text-xl",children:"âš ï¸"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Confirmation de suppression"})]}),e.jsx("p",{className:"text-slate-600 mb-6",children:G}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(N,{onClick:()=>_(!1),children:"Annuler"}),e.jsx(j,{onClick:()=>S&&S(),disabled:M,className:"bg-red-600 hover:bg-red-700 focus:bg-red-700",children:M?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Suppression..."]}):"Supprimer"})]})]})}),e.jsx(H,{show:le,onClose:()=>D(!1),children:e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mr-4",children:e.jsx("span",{className:"text-red-600 text-xl",children:"âš ï¸"})}),e.jsx("h3",{className:"text-lg font-bold text-slate-800",children:"Confirmation de suppression"})]}),e.jsx("p",{className:"text-slate-600 mb-6",children:G}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(N,{onClick:()=>D(!1),children:"Annuler"}),e.jsx(j,{onClick:()=>S&&S(),disabled:M,className:"bg-red-600 hover:bg-red-700 focus:bg-red-700",children:M?e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsxs("svg",{className:"animate-spin h-4 w-4",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Suppression..."]}):"Supprimer"})]})]})})]})}export{Se as default};
